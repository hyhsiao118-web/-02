<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—… - è¡Œç¨‹æ”»ç•¥</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React, ReactDOM, Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            margin: 0;
            padding: 0;
            background-color: #f8fafc;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .bg-gradient-header {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
        }
        
        .timeline-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #6366f1;
            border: 3px solid #e0e7ff;
            z-index: 10;
        }

        .timeline-dot-custom {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #10b981;
            border: 3px solid #d1fae5;
            z-index: 10;
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-in { animation: scaleIn 0.2s ease-out; }
        @keyframes scaleIn {
            from { opacity: 0; scale: 0.95; }
            to { opacity: 1; scale: 1; }
        }
        
        textarea {
            resize: none;
            overflow: hidden;
        }

        .clickable-link {
            color: #4f46e5;
            text-decoration: underline;
            text-underline-offset: 4px;
            transition: color 0.2s;
        }
        .clickable-link:hover {
            color: #3730a3;
        }

        @media print {
            .no-print { display: none; }
            body { background-color: white; }
            .print-only { display: block !important; }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="flex flex-col items-center justify-center min-h-screen text-slate-400">
            <p>æ­£åœ¨è¼‰å…¥æ‚¨çš„å°ˆå±¬è¡Œç¨‹è¡¨...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // åœ–ç¤ºçµ„ä»¶
        const Icon = ({ name, size = 16, className = "" }) => {
            const icons = {
                MapPin: "ğŸ“", Calendar: "ğŸ“…", ShoppingBag: "ğŸ›ï¸", Train: "ğŸš„",
                Info: "ğŸ“", Check: "âœ…", Copy: "ğŸ“‹", Plus: "â•",
                CloudSnow: "â„ï¸", Navigation: "ğŸ§­", Car: "ğŸš—", Camera: "ğŸ“·",
                Trash: "ğŸ—‘ï¸", Edit: "âœï¸", Save: "ğŸ’¾", Link: "ğŸ”—", List: "ğŸ“œ",
                Download: "ğŸ“¥"
            };
            return <span className={`mr-1 ${className}`}>{icons[name] || "â€¢"}</span>;
        };

        const App = () => {
            const [activeDay, setActiveDay] = useState(1);
            const [copied, setCopied] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [showExportModal, setShowExportModal] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [modalType, setModalType] = useState('itinerary'); 
            const [formData, setFormData] = useState({ title: '', time: '', note: '', link: '', desc: '' });

            // --- è³‡æ–™ç‹€æ…‹ç®¡ç† ---

            // 1. å…¨è¡Œç¨‹è³‡æ–™åº«
            const [itineraryDB, setItineraryDB] = useState(() => {
                const saved = localStorage.getItem('kyoto_travel_itinerary_v3');
                if (saved) return JSON.parse(saved);
                
                return {
                    1: [
                        { id: 'd1-1', time: '08:05', title: 'æ¡ƒåœ’æ©Ÿå ´èµ·é£› (CI156)', note: '5:00 æ´¾è»Šå‡ºç™¼', isDefault: true },
                        { id: 'd1-2', time: '11:35', title: 'æŠµé”é—œè¥¿æ©Ÿå ´ T1', note: 'å¾ C å‡ºå£æ­åˆ©æœ¨æ´¥å·´å£«', isDefault: true },
                        { id: 'd1-3', time: '14:00', title: 'äº¬éƒ½è»Šç«™ç”¨é¤', note: 'æ¨è–¦æ‹‰éºµå°è·¯', link: 'https://www.kyoto-ramen-koji.com/', isDefault: true },
                        { id: 'd1-4', time: '15:00', title: 'ç´ å±…æ—…èˆ Check-in', note: 'æ­¥è¡Œ10åˆ†é˜å¯é”æ¸…æ°´å¯º', link: 'https://guesthousesoi.com/rooms-tw/', isDefault: true }
                    ],
                    2: [
                        { id: 'd2-1', time: '09:00', title: 'ä¼è¦‹æ¡ƒå±±è€è¡—', note: 'é…’è—å·¡ç¦®', isDefault: true },
                        { id: 'd2-2', time: '11:00', title: 'ä¼è¦‹åçŸ³èˆŸ', note: 'æ­èˆ¹æ•£ç­–', link: 'https://fushimi-ykk.com/jikkokubune/', isDefault: true },
                        { id: 'd2-3', time: '14:00', title: 'å®‡æ²»å¹³ç­‰é™¢', note: 'é«”é©—æ­£å®—æŠ¹èŒ¶', link: 'https://www.byodoin.or.jp/', isDefault: true }
                    ],
                    3: [
                        { id: 'd3-1', time: '09:30', title: 'å–è»Šï¼šæ¸…æ°´å¯ºé™„è¿‘', note: 'æº–å‚™å¥½é–‹å§‹å–®è»Šè¡Œ', link: 'https://www.hellocycling.jp/', isDefault: true },
                        { id: 'd3-2', time: '11:00', title: 'å…«å‚ç¥ç¤¾ & ç¥‡åœ’', note: 'ç©¿æ¢­å¤æ„è¡—å¼„', isDefault: true },
                        { id: 'd3-3', time: '14:00', title: 'é´¨å·å¹³å¦æ²³å²¸', note: 'é¨è»Šæœ€èˆ’æœçš„åœ°æ®µ', isDefault: true },
                        { id: 'd3-4', time: '17:30', title: 'æ²³åŸç”ºé‚„è»Š', note: 'æ™šé¤äº«å—äº¬æ–™ç†', isDefault: true }
                    ],
                    4: [
                        { id: 'd4-1', time: '08:30', title: 'ç§Ÿè»Šå‡ºç™¼', note: 'ç¢ºèªé…å‚™é›ªèƒ', isDefault: true },
                        { id: 'd4-2', time: '11:30', title: 'ç¾å±±èŒ…è‘ºä¹‹é‡Œ', note: 'é€ è¨ªçµ•ç¾é›ªåœ°åˆæŒå±‹', link: 'https://miyamanavi.com/zh/sightseeing/kayabuki-no-sato', isDefault: true },
                        { id: 'd4-3', time: '15:00', title: 'ç¾å±±æ°‘å®¿å…¥ä½', note: 'é é›¢å¡µå›‚çš„å¯§éœ', isDefault: true }
                    ],
                    5: [
                        { id: 'd5-1', time: '10:00', title: 'åµå±±æ¸¡æœˆæ©‹', note: 'ç«¹æ—å°å¾‘èˆ‡æ‹ç…§', isDefault: true },
                        { id: 'd5-2', time: '16:00', title: 'æ­¸é‚„ç§Ÿè»Š', note: 'äº¬éƒ½è»Šç«™å‘¨é‚Šé‚„è»Š', isDefault: true },
                        { id: 'd5-3', time: '18:00', title: 'å‰å¾€å¤§é˜ªé£¯åº—', note: 'æº–å‚™é€²å…¥ç¾é£Ÿä¹‹éƒ½', isDefault: true }
                    ],
                    6: [
                        { id: 'd6-1', time: '08:30', title: 'æ–°å¤§é˜ªå‡ºç™¼', note: 'æ­ä¹˜æ–°å¹¹ç·šå‰å¾€å§¬è·¯', isDefault: true },
                        { id: 'd6-2', time: '10:00', title: 'ç™»ä¸Šå§¬è·¯åŸ', note: 'ä¿¯ç°æ•´å€‹åŸå¸‚ç¾æ™¯', link: 'https://www.himejicastle.jp/cn/', isDefault: true },
                        { id: 'd6-3', time: '18:00', title: 'å¿ƒé½‹æ©‹ç­‹', note: 'æ„Ÿå—å¤§é˜ªç†±é¬§å¤œç”Ÿæ´»', isDefault: true }
                    ],
                    7: [
                        { id: 'd7-1', time: '11:00', title: 'æŠµé” Rinku Town', note: 'æœ€å¾Œæ¡è²·æˆ°å ´', link: 'https://www.premiumoutlets.co.jp/rinkutown/', isDefault: true },
                        { id: 'd7-2', time: '14:00', title: 'Rinku Outlet', note: 'åœ‹éš›å“ç‰Œæœ€å¾ŒæŠ˜æ‰£', isDefault: true },
                        { id: 'd7-3', time: '17:00', title: 'é—œè¥¿æ©Ÿå ´å ±åˆ°', note: 'æº–å‚™è¿”èˆª', isDefault: true }
                    ]
                };
            });

            // 2. è³¼ç‰©æ¸…å–®è³‡æ–™åº«
            const [shoppingDB, setShoppingDB] = useState(() => {
                const saved = localStorage.getItem('kyoto_travel_shopping_v3');
                if (saved) return JSON.parse(saved);
                return {
                    1: [{ id: 's1-1', title: 'Porta åœ°ä¸‹è¡—é›œè²¨', desc: 'æµè¡Œæœé£¾èˆ‡è—¥å¦', link: 'https://www.yodobashi.com/ec/store/0033/', isDefault: true }],
                    2: [{ id: 's2-1', title: 'ä¸­æ‘è—¤å‰æŠ¹èŒ¶', desc: 'å¿…è²·æŠ¹èŒ¶ç”œé»', link: 'https://tokichi.jp/zh-TW/', isDefault: true }],
                    3: [{ id: 's3-1', title: 'SOUãƒ»SOU ç¹”ç‰©', desc: 'äº¬éƒ½è³ªæ„Ÿç¹”ç‰©', link: 'https://www.sousou.co.jp/', isDefault: true }]
                };
            });

            // 3. ç‹€æ…‹èˆ‡ç­†è¨˜
            const [statusData, setStatusData] = useState(() => {
                const saved = localStorage.getItem('kyoto_travel_status_v3');
                return saved ? JSON.parse(saved) : { temp: "2Â°C - 9Â°C", transport: "ICOCA / JR Pass", misc: "æœ¬åœ°è‡ªå‹•å­˜æª”ä¸­" };
            });
            const [dailyNotes, setDailyNotes] = useState(() => {
                const saved = localStorage.getItem('kyoto_travel_notes_v3');
                return saved ? JSON.parse(saved) : {};
            });

            // è‡ªå‹•å­˜æª”
            useEffect(() => { localStorage.setItem('kyoto_travel_itinerary_v3', JSON.stringify(itineraryDB)); }, [itineraryDB]);
            useEffect(() => { localStorage.setItem('kyoto_travel_shopping_v3', JSON.stringify(shoppingDB)); }, [shoppingDB]);
            useEffect(() => { localStorage.setItem('kyoto_travel_status_v3', JSON.stringify(statusData)); }, [statusData]);
            useEffect(() => { localStorage.setItem('kyoto_travel_notes_v3', JSON.stringify(dailyNotes)); }, [dailyNotes]);

            // --- æ’åºé‚è¼¯ ---
            const getMinutes = (timeStr) => {
                if (!timeStr) return 9999;
                const match = timeStr.match(/(\d{1,2})[:ï¼š](\d{1,2})/);
                return match ? parseInt(match[1]) * 60 + parseInt(match[2]) : 9999;
            };

            const getSortedDay = (dayIndex) => {
                return [...(itineraryDB[dayIndex] || [])].sort((a, b) => getMinutes(a.time) - getMinutes(b.time));
            };

            const sortedItinerary = useMemo(() => getSortedDay(activeDay), [activeDay, itineraryDB]);

            // --- åŒ¯å‡ºæ–‡å­—ç”¢ç”Ÿ ---
            const generateFullText = () => {
                let text = "âœˆï¸ äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…è¡Œç¨‹ç¸½è¦½ âœˆï¸\n\n";
                text += `ğŸŒ¡ï¸ é ä¼°æ°£æº«ï¼š${statusData.temp}\nğŸš„ äº¤é€šæ–¹å¼ï¼š${statusData.transport}\nğŸ“Œ å‚™è¨»ï¼š${statusData.misc}\n\n`;
                
                for (let d = 1; d <= 7; d++) {
                    const dayData = initialData[d];
                    text += `ã€Day ${d} | ${dayData.date}ã€‘\nğŸ“ ${dayData.title}\n`;
                    
                    const dayItinerary = getSortedDay(d);
                    if (dayItinerary.length > 0) {
                        text += `--- è¡Œç¨‹è·¯ç·š ---\n`;
                        dayItinerary.forEach(item => {
                            text += `  â° ${item.time || '--:--'} ${item.title}`;
                            if (item.link) text += ` (ğŸ”— æœ‰é€£çµ)`;
                            text += `\n`;
                        });
                    }

                    const dayShop = shoppingDB[d] || [];
                    if (dayShop.length > 0) {
                        text += `--- è³¼ç‰©æ¸…å–® ---\n`;
                        dayShop.forEach(s => text += `  ğŸ›ï¸ ${s.title}\n`);
                    }

                    const note = dailyNotes[d] || dayData.defaultTips;
                    if (note) {
                        text += `--- ç•¶æ—¥å‚™è¨» ---\n  ${note}\n`;
                    }
                    text += `\n`;
                }
                return text;
            };

            const copyFullList = () => {
                const text = generateFullText();
                const el = document.createElement('textarea');
                el.value = text;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const openModal = (type, item = null) => {
                setModalType(type);
                if (item) {
                    setEditingItem(item);
                    setFormData({ 
                        title: item.title || '', 
                        time: item.time || '', 
                        note: item.note || '', 
                        link: item.link || '', 
                        desc: item.desc || '' 
                    });
                } else {
                    setEditingItem(null);
                    setFormData({ title: '', time: '', note: '', link: '', desc: '' });
                }
                setShowModal(true);
            };

            const handleSave = (e) => {
                e.preventDefault();
                const db = modalType === 'itinerary' ? itineraryDB : shoppingDB;
                const setDb = modalType === 'itinerary' ? setItineraryDB : setShoppingDB;
                const currentList = db[activeDay] || [];

                if (editingItem) {
                    setDb({
                        ...db,
                        [activeDay]: currentList.map(item => 
                            item.id === editingItem.id ? { ...item, ...formData } : item
                        )
                    });
                } else {
                    const newItem = { 
                        ...formData, 
                        id: Date.now().toString(), 
                        isDefault: false 
                    };
                    setDb({ ...db, [activeDay]: [...currentList, newItem] });
                }
                setShowModal(false);
            };

            const deleteItem = (id) => {
                if (!confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) return;
                const db = modalType === 'itinerary' ? itineraryDB : shoppingDB;
                const setDb = modalType === 'itinerary' ? setItineraryDB : setShoppingDB;
                setDb({ ...db, [activeDay]: db[activeDay].filter(item => item.id !== id) });
                setShowModal(false);
            };

            const initialData = {
                1: { date: '2/8 (æ—¥)', title: 'æŠµé”äº¬éƒ½ï¼šäº¬éƒ½è»Šç«™å¤§è§£é–', defaultTips: 'äº¬éƒ½è»Šç«™å¾ˆå¤§ï¼ŒæŠµé”å¾Œå¯ä»¥å…ˆåœ¨ç«™å…§ç™¾è²¨åƒåˆé¤ã€‚' },
                2: { date: '2/9 (ä¸€)', title: 'å¤æ„æ¼«æ­¥ï¼šä¼è¦‹èˆ‡å®‡æ²»', defaultTips: 'ä¼è¦‹åˆ°å®‡æ²»è½‰è»Šéå¸¸æ–¹ä¾¿ï¼Œå»ºè­°è²·å€‹æŠ¹èŒ¶å†°æ·‡æ·‹åƒã€‚' },
                3: { date: '2/10 (äºŒ)', title: 'äº¬éƒ½å¸‚å€ï¼še-Bike å–®è»Šå†’éšª', defaultTips: 'è¨˜å¾—ä¸‹è¼‰ Hello Cycling APP ä¸¦é å…ˆç¶å®šä¿¡ç”¨å¡ã€‚' },
                4: { date: '2/11 (ä¸‰)', title: 'æ·±å±±ç¥•å¢ƒï¼šç¾å±±åˆæŒæ‘è‡ªé§•', defaultTips: 'å±±å€å†·åº¦åŠ å€ï¼Œä¸€å®šè¦æº–å‚™ç™¼ç†±è¡£èˆ‡é˜²æ»‘é‹ã€‚' },
                5: { date: '2/12 (å››)', title: 'åµå±±çµ•æ™¯ & ç§»å‹•è‡³å¤§é˜ª', defaultTips: 'åµå±±çš„åº—é—œå¾—æ—©ï¼Œä¸‹åˆä¸‰é»å‰å¯ä»¥å¤šé€›é€›ã€‚' },
                6: { date: '2/13 (äº”)', title: 'åœ‹å¯¶å§¬è·¯åŸï¼šç™½é·ºå‚³å¥‡', defaultTips: 'å»ºè­°è²·å§¬è·¯åŸï¼‹å¥½å¤åœ’çš„è¯ç¥¨æ¯”è¼ƒåŠƒç®—å–”ï¼' },
                7: { date: '2/14 (å…­)', title: 'æœ€å¾Œæ¡è²· & æº«æš–çš„å®¶', defaultTips: 'è¡Œæå¯ä»¥å…ˆå¯„æ”¾åœ¨ Outlet å°ˆå±¬ç½®ç‰©æ«ƒã€‚' }
            };

            return (
                <div className="flex flex-col min-h-screen text-slate-800">
                    <header className="bg-gradient-header text-white p-6 shadow-xl sticky top-0 z-30 no-print">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl md:text-2xl font-bold flex items-center">
                                    <Icon name="MapPin" /> äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—…
                                </h1>
                                <p className="text-indigo-200 text-xs mt-1 italic font-medium">å€‹äººå°ˆå±¬ç·¨è¼¯åœ°åœ–</p>
                            </div>
                            <button 
                                onClick={() => setShowExportModal(true)} 
                                className="bg-white text-indigo-900 px-4 py-2 rounded-xl text-xs font-bold shadow-lg hover:bg-indigo-50 transition-all flex items-center"
                            >
                                <Icon name="List" /> åŒ¯å‡ºæ¸…å–®
                            </button>
                        </div>
                    </header>

                    <nav className="bg-white border-b sticky top-[80px] md:top-[88px] z-20 overflow-x-auto no-scrollbar shadow-sm no-print">
                        <div className="max-w-4xl mx-auto flex px-4">
                            {[1,2,3,4,5,6,7].map(d => (
                                <button key={d} onClick={() => setActiveDay(d)} className={`flex-none px-6 py-4 text-sm font-black transition-all border-b-4 ${activeDay === d ? 'border-indigo-600 text-indigo-600' : 'border-transparent text-slate-400 hover:text-slate-600'}`}>
                                    Day {d}
                                </button>
                            ))}
                        </div>
                    </nav>

                    <main className="flex-1 max-w-4xl mx-auto w-full p-4 md:p-6 pb-24 space-y-6 fade-in no-print">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            
                            <div className="lg:col-span-2 space-y-6">
                                <section className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="p-6">
                                        <div className="flex justify-between items-center mb-6">
                                            <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center">
                                                <Icon name="Calendar" /> è¡Œç¨‹è·¯ç·š
                                            </h3>
                                            <button onClick={() => openModal('itinerary')} className="bg-indigo-50 text-indigo-600 px-3 py-1.5 rounded-full text-xs font-bold hover:bg-indigo-100 flex items-center transition-all">
                                                <Icon name="Plus" /> æ–°å¢
                                            </button>
                                        </div>

                                        <div className="space-y-6 relative">
                                            {sortedItinerary.map((item, i) => (
                                                <div key={item.id} className="flex gap-4 relative fade-in group cursor-pointer" onClick={() => openModal('itinerary', item)}>
                                                    {i !== sortedItinerary.length - 1 && <div className="absolute left-[6px] top-6 w-[2px] h-full bg-slate-100"></div>}
                                                    <div className={`${item.isDefault ? 'timeline-dot' : 'timeline-dot-custom'} mt-1.5 flex-shrink-0`}></div>
                                                    <div className="flex-1 pb-4">
                                                        <div className="flex flex-col md:flex-row md:justify-between md:items-baseline mb-1">
                                                            <span className={`text-xs font-black ${item.isDefault ? 'text-indigo-500' : 'text-emerald-600'} md:w-16`}>
                                                                {item.time || 'æœªå®šæ™‚'}
                                                            </span>
                                                            <div className="flex justify-between items-center flex-1">
                                                                <h4 className={`font-bold text-lg flex items-center gap-1 ${item.isDefault ? 'text-slate-800' : 'text-emerald-800'}`}>
                                                                    {item.link ? (
                                                                        <a 
                                                                            href={item.link} 
                                                                            target="_blank" 
                                                                            rel="noopener noreferrer" 
                                                                            className="clickable-link"
                                                                            onClick={(e) => e.stopPropagation()}
                                                                        >
                                                                            {item.title} <Icon name="Link" size={14} className="opacity-60" />
                                                                        </a>
                                                                    ) : item.title}
                                                                </h4>
                                                                <div className="opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 text-slate-300 text-xs font-bold uppercase">
                                                                    <Icon name="Edit" size={14} /> ç·¨è¼¯
                                                                </div>
                                                            </div>
                                                        </div>
                                                        {item.note && (
                                                            <p className={`text-sm p-3 rounded-2xl border inline-block mt-2 font-medium leading-relaxed ${item.isDefault ? 'text-slate-500 bg-slate-50 border-slate-100' : 'text-emerald-600 bg-emerald-50/30 border-emerald-100'}`}>
                                                                {item.note}
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                            {sortedItinerary.length === 0 && <p className="text-center py-10 text-slate-300 font-bold italic">ä»Šæ—¥å°šç„¡è¡Œç¨‹...</p>}
                                        </div>
                                    </div>
                                </section>

                                <section className="bg-amber-50 rounded-3xl p-6 border border-amber-200 space-y-3">
                                    <h4 className="font-bold text-amber-900 text-sm flex items-center">
                                        <Icon name="Info" /> ç•¶æ—¥å‚™è¨»
                                    </h4>
                                    <textarea 
                                        className="w-full bg-transparent border-none focus:ring-0 text-amber-800 text-sm font-medium leading-relaxed placeholder-amber-300 min-h-[80px]"
                                        placeholder="è¼¸å…¥ä»Šå¤©çš„ç­†è¨˜..."
                                        value={dailyNotes[activeDay] || ''}
                                        onChange={(e) => setDailyNotes({...dailyNotes, [activeDay]: e.target.value})}
                                    ></textarea>
                                </section>
                            </div>

                            <div className="space-y-6">
                                <section className="bg-white rounded-3xl shadow-sm p-6 border border-slate-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <div className="flex items-center gap-2 text-rose-500 font-black text-sm uppercase tracking-wider">
                                            <Icon name="ShoppingBag" /> è³¼ç‰©æ¸…å–®
                                        </div>
                                        <button onClick={() => openModal('shopping')} className="text-rose-400 hover:text-rose-600 transition-colors">
                                            <Icon name="Plus" />
                                        </button>
                                    </div>
                                    <div className="space-y-3">
                                        {(shoppingDB[activeDay] || []).map((shop) => (
                                            <div key={shop.id} onClick={() => openModal('shopping', shop)} className="p-4 rounded-2xl border border-slate-100 bg-slate-50 hover:bg-rose-50 hover:border-rose-200 transition-all cursor-pointer group fade-in">
                                                <div className="flex justify-between items-start">
                                                    <div className="font-bold text-slate-800 text-sm flex items-center gap-1">
                                                        {shop.link ? (
                                                            <a href={shop.link} target="_blank" rel="noopener noreferrer" className="clickable-link" onClick={(e) => e.stopPropagation()}>
                                                                {shop.title} <Icon name="Link" size={12} className="opacity-60" />
                                                            </a>
                                                        ) : shop.title}
                                                    </div>
                                                    <Icon name="Edit" size={12} className="opacity-0 group-hover:opacity-40" />
                                                </div>
                                                {shop.desc && <div className="text-[10px] text-slate-400 mt-1 font-medium">{shop.desc}</div>}
                                            </div>
                                        ))}
                                    </div>
                                </section>

                                <section className="bg-slate-900 rounded-3xl p-6 text-white shadow-xl">
                                    <h3 className="font-bold text-[10px] text-indigo-300 uppercase tracking-widest mb-5 text-center">ç‹€æ…‹æ¬„ (å¯ç·¨è¼¯)</h3>
                                    <div className="space-y-5">
                                        <div className="flex items-center gap-4 group">
                                            <div className="text-2xl bg-white/10 p-2 rounded-xl"><Icon name="CloudSnow" /></div>
                                            <div className="flex-1">
                                                <div className="text-[10px] opacity-50 font-bold uppercase tracking-tighter">æ°£æº«é å ±</div>
                                                <input className="w-full bg-transparent border-none p-0 text-sm font-black focus:ring-0 text-white" value={statusData.temp} onChange={(e) => setStatusData({...statusData, temp: e.target.value})} />
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-4 group">
                                            <div className="text-2xl bg-white/10 p-2 rounded-xl"><Icon name="Train" /></div>
                                            <div className="flex-1">
                                                <div className="text-[10px] opacity-50 font-bold uppercase tracking-tighter">ä¸»è¦äº¤é€š</div>
                                                <input className="w-full bg-transparent border-none p-0 text-sm font-black focus:ring-0 text-white" value={statusData.transport} onChange={(e) => setStatusData({...statusData, transport: e.target.value})} />
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-4 group">
                                            <div className="text-2xl bg-white/10 p-2 rounded-xl"><Icon name="Camera" /></div>
                                            <div className="flex-1">
                                                <div className="text-[10px] opacity-50 font-bold uppercase tracking-tighter">å‚™è¨»äº‹é …</div>
                                                <input className="w-full bg-transparent border-none p-0 text-sm font-black focus:ring-0 text-emerald-400" value={statusData.misc} onChange={(e) => setStatusData({...statusData, misc: e.target.value})} />
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </main>

                    {/* è¡Œç¨‹ç·¨è¼¯ Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl scale-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold flex items-center">
                                        <Icon name={editingItem ? "Edit" : "Plus"} /> {editingItem ? 'ç·¨è¼¯å…§å®¹' : 'æ–°å¢å…§å®¹'}
                                    </h3>
                                    {editingItem && (
                                        <button onClick={() => deleteItem(editingItem.id)} className="text-slate-300 hover:text-red-500 transition-colors">
                                            <Icon name="Trash" size={20} />
                                        </button>
                                    )}
                                </div>
                                <form onSubmit={handleSave} className="space-y-4">
                                    {modalType === 'itinerary' && (
                                        <div>
                                            <label className="text-[10px] font-bold text-slate-400 uppercase ml-1">æ™‚é–“ (å¦‚ 09:30)</label>
                                            <input type="text" value={formData.time} placeholder="å¦‚ 14:30" onChange={e => setFormData({...formData, time: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" />
                                        </div>
                                    )}
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase ml-1">æ¨™é¡Œ / åç¨±</label>
                                        <input type="text" value={formData.title} placeholder="è¦åšä»€éº¼ï¼Ÿ" onChange={e => setFormData({...formData, title: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" required />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase ml-1">é€£çµ (URL)</label>
                                        <input type="url" value={formData.link} placeholder="https://..." onChange={e => setFormData({...formData, link: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" />
                                    </div>
                                    <div>
                                        <label className="text-[10px] font-bold text-slate-400 uppercase ml-1">{modalType === 'itinerary' ? 'å‚™è¨»' : 'æè¿°'}</label>
                                        <input type="text" value={modalType === 'itinerary' ? formData.note : formData.desc} placeholder="è£œå……èªªæ˜..." onChange={e => setFormData({...formData, [modalType === 'itinerary' ? 'note' : 'desc']: e.target.value})} className="w-full p-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm focus:ring-2 focus:ring-indigo-500 outline-none" />
                                    </div>
                                    <div className="flex gap-2 pt-2">
                                        <button type="button" onClick={() => setShowModal(false)} className="flex-1 p-3 font-bold text-slate-500 hover:bg-slate-50 rounded-2xl transition-all">å–æ¶ˆ</button>
                                        <button type="submit" className={`flex-1 p-3 text-white font-bold rounded-2xl shadow-lg transition-all ${modalType === 'itinerary' ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-rose-500 hover:bg-rose-600'}`}>
                                            <Icon name="Save" /> ä¿å­˜
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* åŒ¯å‡ºæ¸…å–® Modal */}
                    {showExportModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-3xl w-full max-w-2xl max-h-[90vh] shadow-2xl scale-in overflow-hidden flex flex-col">
                                <div className="p-6 border-b flex justify-between items-center bg-slate-50">
                                    <h3 className="text-xl font-bold flex items-center gap-2">
                                        <Icon name="List" size={24} className="text-indigo-600" /> å…¨è¡Œç¨‹ç¸½è¦½åŒ¯å‡º
                                    </h3>
                                    <button onClick={() => setShowExportModal(false)} className="text-slate-400 hover:text-slate-600 text-2xl font-bold">&times;</button>
                                </div>
                                
                                <div className="flex-1 p-6 overflow-y-auto bg-white font-mono text-sm">
                                    <div className="p-4 bg-slate-50 rounded-xl border border-slate-100 whitespace-pre-wrap leading-relaxed">
                                        {generateFullText()}
                                    </div>
                                </div>

                                <div className="p-6 border-t bg-slate-50 flex flex-col md:flex-row gap-3">
                                    <button 
                                        onClick={copyFullList}
                                        className={`flex-1 p-3 rounded-2xl font-bold transition-all flex justify-center items-center gap-2 ${copied ? 'bg-emerald-500 text-white' : 'bg-indigo-600 text-white hover:bg-indigo-700'}`}
                                    >
                                        <Icon name={copied ? "Check" : "Copy"} />
                                        {copied ? "å·²æˆåŠŸè¤‡è£½ï¼" : "ä¸€éµè¤‡è£½æ–‡å­—æ¸…å–®"}
                                    </button>
                                    <button 
                                        onClick={() => window.print()}
                                        className="p-3 bg-white border border-slate-200 text-slate-700 rounded-2xl font-bold hover:bg-slate-100 flex justify-center items-center gap-2"
                                    >
                                        <Icon name="Download" /> åˆ—å° / å­˜ç‚º PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* åˆ—å°å°ˆç”¨å€åŸŸ (éš±è—) */}
                    <div className="hidden print-only p-8 text-black bg-white">
                        <h1 className="text-3xl font-bold mb-6 border-b-4 border-black pb-2 text-center uppercase tracking-widest">
                            âœˆï¸ äº¬éƒ½ãƒ»å¤§é˜ªå†¬æ—¥æ—… âœˆï¸
                        </h1>
                        <div className="mb-8 p-4 bg-gray-100 rounded-lg">
                            <p><strong>ğŸŒ¡ï¸ æ°£æº«ï¼š</strong>{statusData.temp}</p>
                            <p><strong>ğŸš„ äº¤é€šï¼š</strong>{statusData.transport}</p>
                            <p><strong>ğŸ“Œ å‚™è¨»ï¼š</strong>{statusData.misc}</p>
                        </div>
                        <div className="whitespace-pre-wrap text-sm leading-loose">
                            {generateFullText()}
                        </div>
                    </div>

                    <footer className="bg-white border-t p-6 text-center text-slate-400 text-xs font-medium no-print">
                        ğŸ’¡ é»æ“Šã€ŒåŒ¯å‡ºæ¸…å–®ã€å¯å–å¾—å®Œæ•´ 7 å¤©çš„è¡Œç¨‹å½™æ•´ ğŸ”—
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>